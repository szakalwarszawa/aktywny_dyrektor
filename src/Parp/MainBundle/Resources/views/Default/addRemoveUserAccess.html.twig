{% extends '::base.html.twig' %}


{% block body %} 
    <div class="col-sm-4">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapse1">
                Użytkownicy ({{users|length}}) 
                </a>
                </h4>
            </div>
            <div id="collapse1" class="panel-collapse collapse in">
                <div class="panel-body">
                    {% if users|length > 0 %}
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Lp.</th>
                                <th>Użytkownik</th>
                                <th>Login</th>
                            </tr>
                        </thead>
                        {% set n = 1 %}
                        <tbody>
                            {% for row in users %}
                                <tr>
                                    <td><a href="{{ path('userEdit', {samaccountname: row.samaccountname})}}">{{ n }}</a></td>
                                    <td><a href="{{ path('userEdit', {samaccountname: row.samaccountname})}}">{{ row.name  }}</a></td>
                                    <td><a href="{{ path('userEdit', {samaccountname: row.samaccountname})}}">{{ row.samaccountname  }}</a></td>
                                </tr>
                                {% set n = n + 1 %}
                            {% endfor %}
                        </tbody>
                    
                    </table>
                    {% else %}
                    
                    <p>Nie wybrano użytkowników</p>
                    
                    {% endif %}
                    
                </div>
            </div>
        </div>
    
    </div>
    <div class="col-sm-8">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapse1">
                {{title}}
                </a>
                </h4>
            </div>
            <div id="collapse1" class="panel-collapse collapse in">
                <div class="panel-body">
                     {{form(form)}} 
                </div>
            </div>
        </div>
    </div>
    <script>
        function filtrujZasobUprawnienia(){
            var v = $('#form_grupy').val();
            var s = $('#form_nazwafiltr').val().toUpperCase();
            if(v || s){
                $('.uprawnienieRow').addClass('hidden');
                console.log('.uprawnienieRow.grupaUprawnien'+v);                                
                if(s){
                    $('.uprawnienieRow').each(function(){
                        var txt = $(this).text().toUpperCase();
                        var classes = $(this).attr('class');
                        console.log('sprawdzam txt '+txt+' i classes '+classes);
                        var show = false;
                        if(v){
                            show = txt.indexOf(s) >= 0 && classes.indexOf('grupaUprawnien'+v) >= 0;
                        }else{
                            show = txt.indexOf(s) >= 0;
                        } 
                        if(show){
                            $(this).removeClass('hidden');
                        }
                    });
                }else{
                    //pokazujemy szukane grupy
                    $('.uprawnienieRow.grupaUprawnien'+v+'').removeClass('hidden');
                }
                //pokazujemy zaznaczone
                $('.uprawnienieRow input:checked').closest('.uprawnienieRow').removeClass('hidden');
            }else{                
                $('.uprawnienieRow').removeClass('hidden');
            }
        }
        $('#form_grupy').change(function(){
             filtrujZasobUprawnienia();
        });
        $('#form_nazwafiltr').bind('input', function(){
             filtrujZasobUprawnienia();
        });
        $('#form_buttonzaznacz').click(function(){
            $('.uprawnienieRow:not(.hidden) input[type=checkbox]').prop('checked', true);    
        });
        $('#form_buttonodznacz').click(function(){
            $('.uprawnienieRow input[type=checkbox]:checked').prop('checked', false);    
        });
    
    </script>
    
{%endblock%}

{% form_theme form  'bootstrap_3_horizontal_layout.html.twig' _self %}

{% block _form_fromWhen_widget %}
<div class="input-group datepicker" >
    {{ block('form_widget_simple') }}
    <span class="input-group-addon">
        <span class="fa fa-calendar"></span>
    </span>
</div>
{% endblock %} 

{% block _form_access_widget %}
    <div class="col-sm-12 ">
        <div class="col-sm-1">    
            
        </div>
        <div class="col-sm-7">    
            Zasób/uprawnienie
        </div>
        <div class="col-sm-4">    
            Opis
        </div>
    </div>
    {{ block('form_widget') }}
{% endblock %} 

{% block checkbox_radio_row -%}
{% spaceless %}
    <div class="col-sm-12 {% if not valid %} has-error{% endif %} {{label|getMultipleCheckboxLabelClasses }} uprawnienieRow">
        
        {{ form_widget(form) }}
        {{ form_errors(form) }}
    </div>
{% endspaceless %}
{%- endblock checkbox_radio_row %}
{% block checkbox_radio_label %}
    {# Do not display the label if widget is not defined in order to prevent double label rendering #}
    {% if widget is defined %}
        {% if required %}
            {% set label_attr = label_attr|merge({class: (label_attr.class|default('') ~ ' required')|trim}) %}
        {% endif %}
        {% if parent_label_class is defined %}
            {% set label_attr = label_attr|merge({class: (label_attr.class|default('') ~ ' noPadding ' ~ parent_label_class)|trim}) %}
        {% endif %}
        {% if label is not same as(false) and label is empty %}
            {% set label = name|humanize %}
        {% endif %}
            <div class="col-sm-1">
                {{- widget|raw }} 
            </div>
            <div class="col-sm-7">
                <label{% for attrname, attrvalue in label_attr %} {{ attrname }}="{{ attrvalue }}"{% endfor %} 
                data-ajaxload2="/app_dev.php/dev/getUzInfo" data-original-title="Tytuył" class="noPadding">
                {{ (label is not same as(false) ? (translation_domain is same as(false) ? label : label|trans({}, translation_domain)))|getMultipleCheckboxLabel(0) -}}
                </label>
            </div>
            <div class="col-sm-4">
                {{ (label is not same as(false) ? (translation_domain is same as(false) ? label : label|trans({}, translation_domain)))|getMultipleCheckboxLabel(1)|raw}}
                
            </div>
    {% endif %}
{% endblock checkbox_radio_label %}
