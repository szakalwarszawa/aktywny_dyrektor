<script>
function guid() {
  function s4() {
    return Math.floor((1 + Math.random()) * 0x10000)
      .toString(16)
      .substring(1);
  }
  return s4() + s4() + '_' + s4() + '_' + s4() + '_' +
    s4() + '_' + s4() + s4() + s4();
}
$("[data-toggle=tooltip").tooltip();
//$("table").colResizable();
$(document).ready(function(){
    $("table").each(function(){
        if($(this).closest('.tab-pane').length == 0){
            var id = $(this).attr('id');
            if (typeof myVar == 'undefined'){
                id = "tableId"+guid();
                $(this).attr('id', id);
            }
            console.log("Tabelka z id "+id);
            $('#'+id).colResizable();      
        }
    });
    
    $('a[data-toggle="tab"]').on( 'shown.bs.tab', function (e) {
        console.log('adjusting tables');
        console.log($(this).attr('href'));
        $('table', $($(this).attr('href'))).colResizable(); 
        $("table.tablesorter").tablesorter(); 
    } );
    $("table.tablesorter").tablesorter(); 
    
});

$('.tagAjaxInputUsers:not([disabled])').tagit({
    autocomplete: {delay: 0, minLength: 2, source : '/app_dev.php/user/suggest/'},
    allowSpaces: true
});
$('.tagAjaxInput:not([disabled])').tagit({
    allowSpaces: true
});
$(document).ready(function(){
    $('[data-toggle="popover"]').popover({ trigger: "hover" , html: true}); 
});
$('.select2:not([disabled2])').select2({  
    dropdownAutoWidth : true,
    width: '100%'
});

$('.datepicker:not([disabled])').datetimepicker({
    pickTime: false,
    language: 'pl',
    format: 'YYYY-MM-DD',
});
$('.datetimepicker:not([disabled])').datetimepicker({
    pickTime: false,
    language: 'pl',
    format: 'YYYY-MM-DD HH:mm:ss',
});
$('form').areYouSure();

window.onbeforeunload = confirmExit;
function confirmExit() {
    var f = $('form').length > 0 && $('form').hasClass('dirty');
    if(f)
        return ("Masz niezapisane zmiany w formularzu, na pewno chcesz wyjść?");
}
$('form').on('dirty.areYouSure', function() {
  // Enable save button only as the form is dirty.
  $(this).find('input[type="submit"]').removeAttr('disabled');
  $(this).find('input.btncancel').removeAttr('disabled');
});
$('form').on('clean.areYouSure', function() {
  // Form is clean so nothing to save - disable the save button.
  $(this).find('input[type="submit"]').attr('disabled', 'disabled');
  $(this).find('input.btncancel').attr('disabled', 'disabled');
});
function cancelForm(){
    $('input:not(input[type=submit]):not(input[type=button])').each(function(){
        var v1 = $(this).val();
        var v2 = $(this).data('ays-orig');
        console.log('v1 '+v1+' v2 '+v2)
        if(v2 && v2.length > 0 && v1 && v1.length > 0 && v1 != v2)
            $(this).val(v2);        
{#
        if(v1 != v2){
            $(this).addClass('dirty');
        }else{
            $(this).removeClass('dirty');
        }
        
#}
    });
     $('form').trigger('reinitialize.areYouSure');
}
$('*[data-ajaxload]').mouseenter(function() {
    var e=$(this);
    e.off('hover');
    $.get(e.data('ajaxload'),function(d) {
        e.popover({content: d}).popover('show');
    });
}).mouseleave(function() {
    $(this).popover('hide');
});
{#
$('*[data-ajaxload]').bind('hover',function(){
  var e=$(this);
  e.unbind('hover');
  $.get(e.data('ajaxload'),function(d){
      e.popover({content: d}).popover('show');
  });
});
#}

</script>